<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>arthouse</title>
    <link rel="stylesheet" href="/css/landing.css" />
    <link rel="icon" type="image/png" href="images/logo.png" />
    <script defer src="/js/auth.js"></script>
    <script defer src="/js/header.js"></script>
  </head>
  <body>
    <main class="landing-wall">
      <div class="background-video">
        <video id="bgVideo" autoplay muted loop playsinline preload="none">
          <source
            src="https://d1ik7f3dlbml68.cloudfront.net/web/loop.m3u8"
            type="application/x-mpegURL"
          />
          <!-- Fallback for browsers that don't support HLS -->
          <source
            src="https://d1ik7f3dlbml68.cloudfront.net/web/loop.mp4"
            type="video/mp4"
          />
        </video>
      </div>

      <section class="landing-panel hero" aria-labelledby="hero-title">
        <h1 id="hero-title" class="hero-title">
          <span class="serif">Make art. Be seen.</span>
        </h1>
        <p class="hero-sub">
          Arthouse is a place for the next generation of filmmakers. Each piece
          is reviewed by experienced curators, so you don’t have to fight
          against algorithms or noise. Short film submissions are now open for
          Drop 001.
        </p>
        <nav class="hero-actions" aria-label="primary">
          <a class="cta invert" href="/auth/signup.html">Share your film →</a>
        </nav>
      </section>
      <script>
        // Header (kept from your pattern)
        fetch("/partials/header.html")
          .then((r) => r.text())
          .then((html) => {
            document.body.insertAdjacentHTML("afterbegin", html);
            window.authInit && window.authInit();
          })
          .catch(() => {});
      </script>
      <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const video = document.getElementById("bgVideo");
          const hlsUrl = "https://d1ik7f3dlbml68.cloudfront.net/web/loop.m3u8";

          // Check if browser supports native HLS
          if (video.canPlayType("application/vnd.apple.mpegurl")) {
            video.src = hlsUrl;
          } else if (Hls.isSupported()) {
            // Use hls.js for browsers that need JS HLS (like Chrome)
            const hls = new Hls({
              autoStartLoad: true,
              startPosition: -1,
              maxBufferLength: 30,
            });
            hls.loadSource(hlsUrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
              video.play().catch(() => {});
              video.addEventListener("ended", function () {
                video.currentTime = 0;
                video.play().catch(() => {});
              });
            });
          } else {
            // As a fallback, the <source> tag’s MP4 will still play
            console.warn("HLS not supported; falling back to MP4.");
          }
        });
      </script>
    </main>
  </body>
</html>
